<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Conceptual Quiz</title>
    <!-- Inter Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #111827; /* Dark background for a modern feel */
            color: #E5E7EB;
        }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }

        /* Custom gradient for card background */
        .card-bg-gradient {
            background: linear-gradient(135deg, #1F2937, #374151);
        }

        /* Active button style */
        .answer-option.active {
            background-color: #374151;
            border-color: #93C5FD;
        }

        /* Fade-in for explanation panel */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="app-container" class="w-full max-w-5xl mx-auto bg-[#1F2937] rounded-3xl shadow-2xl p-8 lg:p-12 transition-all duration-500 ease-in-out">
        
        <!-- Welcome Screen & Topic Selection -->
        <div id="topic-selection-view" class="flex flex-col items-center text-center">
            <h1 class="text-4xl lg:text-5xl font-bold mb-4 text-white">Chemistry Quiz</h1>
            <p class="text-gray-400 mb-10 text-lg">Select a topic to test your knowledge.</p>

            <!-- Grid for Topic Cards -->
            <div id="topic-grid" class="w-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Topic cards will be dynamically generated here by JavaScript -->
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-view" class="hidden flex-col">
            <!-- Back Button -->
            <button id="back-to-topics-btn" class="self-start mb-6 text-gray-400 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to Topics
            </button>
            
            <div class="bg-gray-800 rounded-2xl p-6 shadow-xl">
                <!-- Progress Bar -->
                <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden mb-6">
                    <div id="progress-bar" class="h-full bg-cyan-500 transition-all duration-300 ease-in-out" style="width: 0%;"></div>
                </div>

                <!-- Question Container -->
                <div id="question-container" class="flex flex-col">
                    <p id="question-text" class="text-xl lg:text-2xl font-medium mb-8 text-white"></p>
                    <div id="options-container" class="grid grid-cols-1 gap-4">
                        <!-- Answer options will be dynamically generated here -->
                    </div>
                </div>

                <!-- Control Buttons and LLM button -->
                <div class="flex justify-between items-center mt-8">
                    <p id="score-counter" class="text-lg text-gray-400 font-semibold"></p>
                    <div class="flex space-x-4">
                         <button id="get-explanation-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 disabled:bg-gray-600 disabled:shadow-none">
                            ✨ Get Explanation
                        </button>
                        <button id="next-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 disabled:bg-gray-600 disabled:shadow-none">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Explanation Container (initially hidden) -->
                <div id="explanation-container" class="hidden mt-8 p-6 bg-gray-700 rounded-xl fade-in">
                    <div id="explanation-loading" class="flex items-center justify-center p-4 hidden">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Generating explanation...</span>
                    </div>
                    <div id="explanation-content" class="text-gray-200"></div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-view" class="hidden flex-col items-center text-center">
            <h2 class="text-3xl lg:text-4xl font-bold mb-4 text-white">Quiz Complete!</h2>
            <p class="text-xl text-gray-400 mb-6">You have finished the quiz.</p>
            <div class="bg-gray-800 rounded-2xl p-8 shadow-xl w-full max-w-lg">
                <h3 class="text-2xl font-semibold mb-4 text-cyan-500">Your Score</h3>
                <p id="final-score" class="text-6xl font-extrabold text-white mb-6"></p>
                <button id="play-again-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                    Play Again
                </button>
            </div>
        </div>
        
    </div>

    <script>
        // Data structure to hold all topics and questions
        const quizData = {
            "Volumetric Analysis": [
                {
                    question: "What is the equivalent mass of an acid?",
                    options: ["Molar mass divided by its valency", "Molar mass divided by its basicity", "Molar mass divided by its acidity", "Molar mass divided by its molarity"],
                    answer: "Molar mass divided by its basicity"
                },
                {
                    question: "The normality equation for a titration is?",
                    options: ["$N_1V_1 = N_2V_2$", "$N_1/V_1 = N_2/V_2$", "$N_1 + V_1 = N_2 + V_2$", "$N_1V_2 = N_2V_1$"],
                    answer: "$N_1V_1 = N_2V_2$"
                },
                {
                    question: "Which of the following is a primary standard substance?",
                    options: ["NaOH", "HCl", "$K_2Cr_2O_7$", "$KMnO_4$"],
                    answer: "$K_2Cr_2O_7$"
                },
                {
                    question: "What is the unit of normality?",
                    options: ["mol/L", "g/L", "Eq/L", "mol/kg"],
                    answer: "Eq/L"
                },
                {
                    question: "In a titration, what is the point where the reaction is complete?",
                    options: ["Endpoint", "Initial point", "Equivalent point", "Neutralization point"],
                    answer: "Equivalent point"
                },
                {
                    question: "The equivalent mass of $Ca(OH)_2$ is?",
                    options: ["Molar mass", "Molar mass/2", "Molar mass/3", "Molar mass/4"],
                    answer: "Molar mass/2"
                },
                {
                    question: "What is the purpose of an indicator in a titration?",
                    options: ["To speed up the reaction", "To measure the temperature", "To show the endpoint of the reaction", "To increase the solubility of the solute"],
                    answer: "To show the endpoint of the reaction"
                },
                {
                    question: "The term 'aliquot' refers to a specific:",
                    options: ["Mass of solvent", "Volume of solute", "Volume of solution", "Mass of reagent"],
                    answer: "Volume of solution"
                },
                {
                    question: "Which type of titration involves a color change at the endpoint?",
                    options: ["Precipitation titration", "Redox titration", "Complexometric titration", "All of the above"],
                    answer: "Redox titration"
                },
                {
                    question: "What is the concentration of a standard solution expressed in?",
                    options: ["Molarity", "Normality", "Molality", "All of the above"],
                    answer: "All of the above"
                }
            ],
            "Ionic Equilibrium": [
                {
                    question: "What is a strong electrolyte?",
                    options: ["A substance that partially ionizes in solution", "A substance that completely ionizes in solution", "A substance that does not ionize in solution", "A substance that only ionizes at high temperatures"],
                    answer: "A substance that completely ionizes in solution"
                },
                {
                    question: "According to the Brønsted-Lowry concept, a base is a substance that can:",
                    options: ["Donate a proton", "Accept a proton", "Donate an electron pair", "Accept an electron pair"],
                    answer: "Accept a proton"
                },
                {
                    question: "The pH of a neutral solution at 25°C is:",
                    options: ["0", "7", "14", "depends on the solution"],
                    answer: "7"
                },
                {
                    question: "Which of the following is a conjugate acid-base pair?",
                    options: ["$HCl$ and $H_2O$", "$NH_3$ and $NH_4^+$", "$H_2SO_4$ and $SO_4^{2-}$", "$CH_3COOH$ and $CH_3OH$"],
                    answer: "$NH_3$ and $NH_4^+$"
                },
                {
                    question: "What is the ionization constant of water, $K_w$?",
                    options: ["$1.0 \times 10^{-7}$", "$1.0 \times 10^{-14}$", "$1.0 \times 10^{-5}$", "It's a variable value"],
                    answer: "$1.0 \times 10^{-14}$"
                },
                {
                    question: "The common ion effect describes the decrease in the solubility of a sparingly soluble salt by adding a compound that has:",
                    options: ["An ion in common with the salt", "A different ion from the salt", "A catalyst for the reaction", "An equal number of protons"],
                    answer: "An ion in common with the salt"
                },
                {
                    question: "A buffer solution is a solution that resists changes in:",
                    options: ["Volume", "Temperature", "pH", "Density"],
                    answer: "pH"
                },
                {
                    question: "The Henderson-Hasselbalch equation relates the pH of a buffer solution to:",
                    options: ["The concentration of acid and base", "The molar mass of the acid", "The temperature of the solution", "The density of the solution"],
                    answer: "The concentration of acid and base"
                },
                {
                    question: "What is the solubility product constant, $K_{sp}$?",
                    options: ["The product of the concentrations of the reactants", "The product of the concentrations of the products", "The product of the ion concentrations in a saturated solution", "The ratio of reactants to products"],
                    answer: "The product of the ion concentrations in a saturated solution"
                },
                {
                    question: "According to the Lewis concept, an acid is a substance that can:",
                    options: ["Donate a proton", "Accept a proton", "Donate an electron pair", "Accept an electron pair"],
                    answer: "Accept an electron pair"
                }
            ],
            "Chemical Kinetics": [
                {
                    question: "The rate of a chemical reaction is defined as the change in concentration of a reactant or product per unit:",
                    options: ["Mass", "Volume", "Time", "Temperature"],
                    answer: "Time"
                },
                {
                    question: "The rate constant of a reaction depends on:",
                    options: ["Initial concentration of reactants", "Temperature", "Pressure", "All of the above"],
                    answer: "Temperature"
                },
                {
                    question: "What is the order of a reaction for which the rate is independent of the reactant concentration?",
                    options: ["First order", "Second order", "Zero order", "Third order"],
                    answer: "Zero order"
                },
                {
                    question: "The half-life of a first-order reaction is independent of:",
                    options: ["Initial concentration", "Temperature", "Pressure", "Catalyst"],
                    answer: "Initial concentration"
                },
                {
                    question: "The Arrhenius equation relates the rate constant to:",
                    options: ["Concentration", "Pressure", "Activation energy and temperature", "Volume"],
                    answer: "Activation energy and temperature"
                }
            ],
            "Thermodynamics": [
                {
                    question: "In an endothermic reaction, the enthalpy change ($\Delta H$) is:",
                    options: ["Positive", "Negative", "Zero", "Dependent on the reaction"],
                    answer: "Positive"
                },
                {
                    question: "The first law of thermodynamics is a statement of the conservation of:",
                    options: ["Mass", "Energy", "Momentum", "Volume"],
                    answer: "Energy"
                },
                {
                    question: "Entropy ($S$) is a measure of a system's:",
                    options: ["Heat content", "Disorder or randomness", "Pressure", "Volume"],
                    answer: "Disorder or randomness"
                },
                {
                    question: "A spontaneous process is one that occurs without outside intervention and is accompanied by a decrease in the system's:",
                    options: ["Entropy", "Gibbs free energy", "Enthalpy", "Volume"],
                    answer: "Gibbs free energy"
                },
                {
                    question: "The standard enthalpy of formation of an element in its most stable form is:",
                    options: ["Positive", "Negative", "Zero", "Dependent on temperature"],
                    answer: "Zero"
                }
            ],
            "Electrochemistry": [
                {
                    question: "The process of oxidation involves the:",
                    options: ["Gain of electrons", "Loss of electrons", "Gain of protons", "Loss of protons"],
                    answer: "Loss of electrons"
                },
                {
                    question: "In a galvanic cell, the anode is the electrode where _____ occurs.",
                    options: ["Reduction", "Oxidation", "Equilibrium", "Neutralization"],
                    answer: "Oxidation"
                },
                {
                    question: "The Nernst equation relates the cell potential to:",
                    options: ["Concentration of reactants and products", "Temperature", "Pressure", "Volume"],
                    answer: "Concentration of reactants and products"
                },
                {
                    question: "What is the purpose of a salt bridge in an electrochemical cell?",
                    options: ["To connect the two half-cells", "To allow flow of electrons", "To maintain electrical neutrality", "To prevent mixing of solutions"],
                    answer: "To maintain electrical neutrality"
                },
                {
                    question: "Faraday's first law of electrolysis states that the mass of a substance deposited is proportional to the:",
                    options: ["Time", "Current", "Charge passed through the electrolyte", "Voltage"],
                    answer: "Charge passed through the electrolyte"
                }
            ],
            "Transition Elements": [
                {
                    question: "Which of the following is not a characteristic of transition elements?",
                    options: ["Variable oxidation states", "Formation of colored ions", "Paramagnetism", "Low melting and boiling points"],
                    answer: "Low melting and boiling points"
                },
                {
                    question: "The general electronic configuration of transition elements is:",
                    options: ["$(n-1)d^{1-10} ns^{1-2}$", "$(n-1)p^{1-6} ns^{2}$", "$ns^{1-2} np^{1-6}$", "$ns^{2} np^{6}$"],
                    answer: "$(n-1)d^{1-10} ns^{1-2}$"
                },
                {
                    question: "The cause of color in transition metal complexes is:",
                    options: ["d-d transitions", "s-p transitions", "f-f transitions", "p-p transitions"],
                    answer: "d-d transitions"
                },
                {
                    question: "Which of the following elements is a transition element?",
                    options: ["Sodium", "Calcium", "Iron", "Zinc"],
                    answer: "Iron"
                },
                {
                    question: "Catalytic properties of transition metals are due to their:",
                    options: ["Variable oxidation states", "High density", "Low ionization energy", "Large atomic radius"],
                    answer: "Variable oxidation states"
                }
            ],
            "Study of Heavy Metals": [
                {
                    question: "Heavy metals are defined by their:",
                    options: ["High atomic weight and density", "High reactivity", "Low melting point", "Low atomic number"],
                    answer: "High atomic weight and density"
                },
                {
                    question: "Which of the following is a common source of lead poisoning?",
                    options: ["Zinc pipes", "Old paint", "Table salt", "Pure water"],
                    answer: "Old paint"
                },
                {
                    question: "Mercury ($Hg$) is known for causing which disease?",
                    options: ["Lead poisoning", "Minamata disease", "Cadmium poisoning", "Arsenicosis"],
                    answer: "Minamata disease"
                },
                {
                    question: "The term 'heavy metal' is scientifically precise.",
                    options: ["True", "False"],
                    answer: "False"
                },
                {
                    question: "Which heavy metal is a component of batteries and can cause kidney damage?",
                    options: ["Lead", "Mercury", "Cadmium", "Arsenic"],
                    answer: "Cadmium"
                }
            ],
            "Haloalkanes": [
                {
                    question: "The reaction of an alkane with a halogen in the presence of UV light is called:",
                    options: ["Addition reaction", "Substitution reaction", "Elimination reaction", "Rearrangement reaction"],
                    answer: "Substitution reaction"
                },
                {
                    question: "Which of the following is an example of an $S_N1$ reaction?",
                    options: ["Reaction of $CH_3Cl$ with $NaOH$", "Reaction of $CH_3CH_2Cl$ with $KOH$", "Reaction of tertiary butyl bromide with water", "Reaction of $CH_3CH_2Cl$ with $NaCN$"],
                    answer: "Reaction of tertiary butyl bromide with water"
                },
                {
                    question: "The boiling point of haloalkanes increases with the number of carbon atoms due to an increase in:",
                    options: ["Hydrogen bonding", "Dipole-dipole forces", "London dispersion forces", "Covalent bonding"],
                    answer: "London dispersion forces"
                },
                {
                    question: "The compound $CHCl_3$ is commonly known as:",
                    options: ["Freon", "Chloroform", "Tetrachloroethane", "Methane"],
                    answer: "Chloroform"
                },
                {
                    question: "Which of the following is used as an anesthetic?",
                    options: ["$C_2H_5Cl$", "$CH_2Cl_2$", "$CHCl_3$", "$CCl_4$"],
                    answer: "$CHCl_3$"
                }
            ],
            "Haloarenes": [
                {
                    question: "What is the common name for the compound $C_6H_5Cl$?",
                    options: ["Bromobenzene", "Chlorobenzene", "Iodobenzene", "Fluorobenzene"],
                    answer: "Chlorobenzene"
                },
                {
                    question: "The Wurtz-Fittig reaction is used to prepare:",
                    options: ["Alkanes", "Alkenes", "Alkylbenzenes", "Aromatic compounds"],
                    answer: "Alkylbenzenes"
                },
                {
                    question: "Haloarenes are less reactive towards nucleophilic substitution reactions than haloalkanes due to:",
                    options: ["Resonance effect", "Inductive effect", "Steric hindrance", "All of the above"],
                    answer: "Resonance effect"
                },
                {
                    question: "The reaction of chlorobenzene with sodium in the presence of dry ether is an example of:",
                    options: ["Fittig reaction", "Wurtz reaction", "Wurtz-Fittig reaction", "Friedel-Crafts reaction"],
                    answer: "Wurtz-Fittig reaction"
                },
                {
                    question: "DDT is an example of a:",
                    options: ["Haloalkane", "Haloarene", "Alcohol", "Ketone"],
                    answer: "Haloarene"
                }
            ],
            "Alcohols": [
                {
                    question: "The general formula for monohydric alcohols is:",
                    options: ["$C_nH_{2n+1}OH$", "$C_nH_{2n}OH$", "$C_nH_{2n-1}OH$", "$C_nH_{2n+2}OH$"],
                    answer: "$C_nH_{2n+1}OH$"
                },
                {
                    question: "The primary product of the hydration of ethene is:",
                    options: ["Methanol", "Ethanol", "Propanol", "Butanol"],
                    answer: "Ethanol"
                },
                {
                    question: "Which of the following has the highest boiling point?",
                    options: ["Methane", "Ethanol", "Ethane", "Dimethyl ether"],
                    answer: "Ethanol"
                },
                {
                    question: "The oxidation of a primary alcohol with a strong oxidizing agent yields:",
                    options: ["An aldehyde", "A ketone", "A carboxylic acid", "An ether"],
                    answer: "A carboxylic acid"
                },
                {
                    question: "The Lucas test is used to distinguish between:",
                    options: ["Primary, secondary, and tertiary alcohols", "Alcohols and phenols", "Alcohols and ethers", "Aldehydes and ketones"],
                    answer: "Primary, secondary, and tertiary alcohols"
                }
            ],
            "Phenols": [
                {
                    question: "Phenol is more acidic than ethanol due to:",
                    options: ["Resonance stabilization of the phenoxide ion", "Inductive effect of the alkyl group", "Steric hindrance", "Hydrogen bonding"],
                    answer: "Resonance stabilization of the phenoxide ion"
                },
                {
                    question: "The reaction of phenol with bromine water gives:",
                    options: ["Bromobenzene", "2,4,6-tribromophenol", "o-bromophenol", "p-bromophenol"],
                    answer: "2,4,6-tribromophenol"
                },
                {
                    question: "Kolbe's reaction is used for the preparation of:",
                    options: ["Salicylic acid", "Phenol", "Benzene", "Aniline"],
                    answer: "Salicylic acid"
                },
                {
                    question: "Which of the following is a test for phenols?",
                    options: ["Litmus paper test", "Sodium bicarbonate test", "Ferric chloride test", "Iodoform test"],
                    answer: "Ferric chloride test"
                },
                {
                    question: "Phenols are used in the preparation of:",
                    options: ["Detergents", "Dyes", "Explosives", "All of the above"],
                    answer: "All of the above"
                }
            ],
            "Ethers": [
                {
                    question: "The general formula for an ether is:",
                    options: ["R-OH", "R-O-R'", "R-CO-R'", "R-CHO"],
                    answer: "R-O-R'"
                },
                {
                    question: "Williamson's synthesis is used to prepare:",
                    options: ["Alcohols", "Aldehydes", "Ethers", "Ketones"],
                    answer: "Ethers"
                },
                {
                    question: "The boiling points of ethers are comparable to those of:",
                    options: ["Alkanes of comparable mass", "Alcohols of comparable mass", "Aldehydes of comparable mass", "Ketones of comparable mass"],
                    answer: "Alkanes of comparable mass"
                },
                {
                    question: "Which of the following is used as an anesthetic?",
                    options: ["Dimethyl ether", "Diethyl ether", "Dipropyl ether", "Methyl propyl ether"],
                    answer: "Diethyl ether"
                },
                {
                    question: "Ethers are separated from alcohols using:",
                    options: ["$H_2SO_4$", "$HCl$", "PCl5", "NaOH"],
                    answer: "$H_2SO_4$"
                }
            ],
            "Aldehydes and Ketones": [
                {
                    question: "The functional group of an aldehyde is:",
                    options: ["$-OH$", "$-CHO$", "$-COOH$", "$-CO-$"],
                    answer: "$-CHO$"
                },
                {
                    question: "The Tollens' test is used to distinguish between:",
                    options: ["Primary and secondary alcohols", "Alcohols and phenols", "Aldehydes and ketones", "Carboxylic acids and esters"],
                    answer: "Aldehydes and ketones"
                },
                {
                    question: "Acetone is a common name for:",
                    options: ["Propanal", "Propanone", "Ethanal", "Butanone"],
                    answer: "Propanone"
                },
                {
                    question: "The product of the reaction of an aldehyde with a reducing agent is a:",
                    options: ["Primary alcohol", "Secondary alcohol", "Tertiary alcohol", "Ether"],
                    answer: "Primary alcohol"
                },
                {
                    question: "Which of the following does not give a positive Tollens' test?",
                    options: ["Formaldehyde", "Acetaldehyde", "Acetone", "Benzaldehyde"],
                    answer: "Acetone"
                }
            ],
            "Carboxylic Acids": [
                {
                    question: "The functional group of a carboxylic acid is:",
                    options: ["$-CO-$", "$-CHO$", "$-COOH$", "$-OH$"],
                    answer: "$-COOH$"
                },
                {
                    question: "The acidity of carboxylic acids is due to the:",
                    options: ["Hydrogen atom on the carbon", "Hydrogen atom on the oxygen", "Electron-donating groups", "Resonance stabilization of the carboxylate ion"],
                    answer: "Resonance stabilization of the carboxylate ion"
                },
                {
                    question: "Which of the following is the strongest acid?",
                    options: ["Formic acid", "Acetic acid", "Propanoic acid", "Butanoic acid"],
                    answer: "Formic acid"
                },
                {
                    question: "The reaction of a carboxylic acid with an alcohol in the presence of an acid catalyst is called:",
                    options: ["Esterification", "Saponification", "Hydrolysis", "Condensation"],
                    answer: "Esterification"
                },
                {
                    question: "Vinegar is a dilute solution of:",
                    options: ["Formic acid", "Acetic acid", "Butyric acid", "Propanoic acid"],
                    answer: "Acetic acid"
                }
            ],
            "Nitro Compounds": [
                {
                    question: "The nitro group ($NO_2$) is an example of a:",
                    options: ["Electron-donating group", "Electron-withdrawing group", "Steric group", "None of the above"],
                    answer: "Electron-withdrawing group"
                },
                {
                    question: "Nitrobenzene can be prepared from benzene by:",
                    options: ["Chlorination", "Nitration", "Sulfonation", "Alkylation"],
                    answer: "Nitration"
                },
                {
                    question: "The reduction of nitrobenzene with Sn and concentrated HCl gives:",
                    options: ["Aniline", "Nitrosobenzene", "Phenylhydroxylamine", "Azobenzene"],
                    answer: "Aniline"
                },
                {
                    question: "TNT is a common explosive, and its full name is:",
                    options: ["Trinitronaphthalene", "Trinitrotoluene", "Trinitrophenol", "Trinitrobenzene"],
                    answer: "Trinitrotoluene"
                },
                {
                    question: "The nitro group is a:",
                    options: ["Meta-directing group", "Ortho-para directing group", "Both a and b", "None of the above"],
                    answer: "Meta-directing group"
                }
            ],
            "Amines": [
                {
                    question: "Amines are derivatives of:",
                    options: ["Water", "Methane", "Ammonia", "Hydrogen sulfide"],
                    answer: "Ammonia"
                },
                {
                    question: "The basicity of amines is due to:",
                    options: ["The lone pair of electrons on the nitrogen atom", "The presence of a double bond", "The acidic hydrogen atoms", "The high electronegativity of nitrogen"],
                    answer: "The lone pair of electrons on the nitrogen atom"
                },
                {
                    question: "Which of the following is the strongest base?",
                    options: ["Aniline", "Ammonia", "Ethylamine", "Dimethylamine"],
                    answer: "Dimethylamine"
                },
                {
                    question: "Hinsberg's test is used to distinguish between:",
                    options: ["Primary, secondary, and tertiary amines", "Alcohols and amines", "Aldehydes and amines", "Carboxylic acids and amines"],
                    answer: "Primary, secondary, and tertiary amines"
                },
                {
                    question: "The Hoffmann bromamide degradation reaction is used to convert:",
                    options: ["Amides to amines", "Amines to amides", "Alcohols to amines", "Ketones to amines"],
                    answer: "Amides to amines"
                }
            ],
            "Organometallic Compounds": [
                {
                    question: "An organometallic compound contains a direct bond between a carbon atom and a:",
                    options: ["Oxygen atom", "Nitrogen atom", "Metal atom", "Halogen atom"],
                    answer: "Metal atom"
                },
                {
                    question: "Grignard reagents are examples of:",
                    options: ["Alkyl halides", "Organometallic compounds", "Ethers", "Ketones"],
                    answer: "Organometallic compounds"
                },
                {
                    question: "The formula for a Grignard reagent is:",
                    options: ["R-X", "R-OH", "R-Mg-X", "R-O-R'"],
                    answer: "R-Mg-X"
                },
                {
                    question: "Grignard reagents are highly reactive due to the polarity of the:",
                    options: ["C-H bond", "C-Mg bond", "Mg-X bond", "C-C bond"],
                    answer: "C-Mg bond"
                },
                {
                    question: "Which of the following is an example of an organometallic compound?",
                    options: ["$CH_3Cl$", "$C_2H_5OH$", "$C_2H_5MgBr$", "$C_6H_6$"],
                    answer: "$C_2H_5MgBr$"
                }
            ],
            "Chemistry in the Service of Mankind": [
                {
                    question: "Which of the following is an example of a synthetic polymer?",
                    options: ["Silk", "Cotton", "Nylon", "Wool"],
                    answer: "Nylon"
                },
                {
                    question: "Detergents work by:",
                    options: ["Increasing the surface tension of water", "Decreasing the surface tension of water", "Forming micelles", "Acting as an abrasive"],
                    answer: "Forming micelles"
                },
                {
                    question: "The chemical used to soften hard water is:",
                    options: ["Sodium chloride", "Sodium carbonate", "Calcium hydroxide", "Magnesium sulfate"],
                    answer: "Sodium carbonate"
                },
                {
                    question: "Which of the following is an antiseptic?",
                    options: ["Dettol", "Aspirin", "Paracetamol", "Penicillin"],
                    answer: "Dettol"
                },
                {
                    question: "The process of converting vegetable oil into vanaspati ghee is called:",
                    options: ["Saponification", "Esterification", "Hydrogenation", "Dehydration"],
                    answer: "Hydrogenation"
                }
            ],
            "Cement, Paper and Pulp": [
                {
                    question: "The main component of cement is:",
                    options: ["Calcium carbonate", "Calcium silicate", "Calcium sulfate", "Calcium oxide"],
                    answer: "Calcium silicate"
                },
                {
                    question: "Gypsum is added to cement to:",
                    options: ["Increase the setting time", "Decrease the setting time", "Increase the strength", "Decrease the strength"],
                    answer: "Increase the setting time"
                },
                {
                    question: "Paper is primarily made from:",
                    options: ["Cellulose", "Lignin", "Starch", "Protein"],
                    answer: "Cellulose"
                },
                {
                    question: "The process of removing lignin from wood pulp is called:",
                    options: ["Sizing", "Bleaching", "Cooking", "Pulping"],
                    answer: "Pulping"
                },
                {
                    question: "The chemical formula for lime used in cement production is:",
                    options: ["$CaO$", "$CaCO_3$", "$Ca(OH)_2$", "$CaSO_4$"],
                    answer: "$CaO$"
                }
            ],
            "Nuclear Chemistry": [
                {
                    question: "Radioactivity is the process of spontaneous emission of radiation by an unstable:",
                    options: ["Atom", "Molecule", "Nucleus", "Ion"],
                    answer: "Nucleus"
                },
                {
                    question: "The half-life of a radioactive isotope is the time required for:",
                    options: ["Half of the atoms to decay", "All of the atoms to decay", "The temperature to drop by half", "The mass to be halved"],
                    answer: "Half of the atoms to decay"
                },
                {
                    question: "Nuclear fission is the process of splitting a heavy nucleus into:",
                    options: ["Lighter nuclei", "Heavier nuclei", "Neutrons", "Protons"],
                    answer: "Lighter nuclei"
                },
                {
                    question: "Fusion reactions occur in:",
                    options: ["Nuclear power plants", "The Sun and stars", "Nuclear bombs", "Nuclear submarines"],
                    answer: "The Sun and stars"
                },
                {
                    question: "The symbol for an alpha particle is:",
                    options: ["$\beta$", "$\gamma$", "$\alpha$", "$e^-$"],
                    answer: "$\alpha$"
                }
            ]
        };

        // DOM elements
        const appContainer = document.getElementById('app-container');
        const topicSelectionView = document.getElementById('topic-selection-view');
        const topicGrid = document.getElementById('topic-grid');
        const quizView = document.getElementById('quiz-view');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const nextBtn = document.getElementById('next-btn');
        const scoreCounter = document.getElementById('score-counter');
        const progressBar = document.getElementById('progress-bar');
        const resultsView = document.getElementById('results-view');
        const finalScore = document.getElementById('final-score');
        const playAgainBtn = document.getElementById('play-again-btn');
        const backToTopicsBtn = document.getElementById('back-to-topics-btn');
        const getExplanationBtn = document.getElementById('get-explanation-btn');
        const explanationContainer = document.getElementById('explanation-container');
        const explanationLoading = document.getElementById('explanation-loading');
        const explanationContent = document.getElementById('explanation-content');

        // Global state variables
        let currentTopic = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOption = null;

        // Function to render topic cards
        function renderTopicCards() {
            topicGrid.innerHTML = '';
            Object.keys(quizData).forEach(topic => {
                const card = document.createElement('div');
                card.className = 'topic-card card-bg-gradient p-6 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 ease-in-out cursor-pointer';
                card.innerHTML = `<h3 class="text-xl font-semibold mb-2 text-white">${topic}</h3><p class="text-gray-400 text-sm">${quizData[topic].length} Questions</p>`;
                card.onclick = () => startQuiz(topic);
                topicGrid.appendChild(card);
            });
        }

        // Function to start the quiz for a selected topic
        function startQuiz(topic) {
            currentTopic = topic;
            currentQuestions = [...quizData[topic]];
            // Shuffle the questions for a new experience each time
            shuffleArray(currentQuestions);
            
            currentQuestionIndex = 0;
            score = 0;
            updateScoreDisplay();
            
            // Show the quiz view and hide others
            topicSelectionView.classList.add('hidden');
            resultsView.classList.add('hidden');
            quizView.classList.remove('hidden');
            
            // Hide explanation from previous session
            explanationContainer.classList.add('hidden');
            
            renderQuestion();
        }

        // Function to render the current question and its options
        function renderQuestion() {
            // Disable next button until an option is selected
            nextBtn.disabled = true;
            nextBtn.textContent = 'Next';
            nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            nextBtn.classList.add('bg-cyan-600', 'hover:bg-cyan-700');
            
            // Hide explanation container for the new question
            explanationContainer.classList.add('hidden');

            if (currentQuestionIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const currentQuestion = currentQuestions[currentQuestionIndex];
            questionText.innerHTML = currentQuestion.question; // Use innerHTML to render LaTeX
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = shuffleArray([...currentQuestion.options]);

            shuffledOptions.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'answer-option card-bg-gradient text-left w-full py-4 px-6 rounded-xl border border-gray-600 hover:border-cyan-400 transition-colors duration-200';
                optionBtn.innerHTML = option; // Use innerHTML to render LaTeX
                optionBtn.onclick = () => selectOption(optionBtn);
                optionsContainer.appendChild(optionBtn);
            });

            // Update progress bar
            const progress = ((currentQuestionIndex) / currentQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Render Math equations if any
            renderMath();
        }

        // Function to handle option selection
        function selectOption(selectedElement) {
            const options = optionsContainer.querySelectorAll('.answer-option');
            options.forEach(option => {
                option.classList.remove('active');
            });
            selectedElement.classList.add('active');
            selectedOption = selectedElement.innerHTML;
            nextBtn.disabled = false;
        }

        // Function to handle the next button click
        nextBtn.onclick = () => {
            const currentQuestion = currentQuestions[currentQuestionIndex];
            if (selectedOption === currentQuestion.answer) {
                score++;
                updateScoreDisplay();
            }
            
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                renderQuestion();
            } else {
                showResults();
            }
        };

        // Function to update the score display
        function updateScoreDisplay() {
            scoreCounter.textContent = `Score: ${score} / ${currentQuestions.length}`;
        }

        // Function to show the final results
        function showResults() {
            quizView.classList.add('hidden');
            resultsView.classList.remove('hidden');
            
            const finalPercentage = Math.round((score / currentQuestions.length) * 100);
            finalScore.textContent = `${finalPercentage}%`;
            
            // Set final progress bar state
            progressBar.style.width = '100%';
        }
        
        // Function to handle the "Play Again" button
        playAgainBtn.onclick = () => {
            resultsView.classList.add('hidden');
            topicSelectionView.classList.remove('hidden');
            renderTopicCards();
        };

        // Function to handle the "Back to Topics" button
        backToTopicsBtn.onclick = () => {
            quizView.classList.add('hidden');
            topicSelectionView.classList.remove('hidden');
            renderTopicCards();
        };

        // LLM Functionality
        getExplanationBtn.onclick = async () => {
            // Show loading and clear previous content
            explanationContainer.classList.remove('hidden');
            explanationLoading.classList.remove('hidden');
            explanationContent.innerHTML = '';
            getExplanationBtn.disabled = true;

            const currentQuestion = currentQuestions[currentQuestionIndex];
            const prompt = `Explain the concept of '${currentTopic}' in chemistry, specifically focusing on the topic of '${currentQuestion.question}' in a clear and concise manner. Provide a brief but comprehensive explanation suitable for a high school or undergraduate chemistry student.`;

            // Gemini API call
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    explanationContent.innerHTML = `<h4 class="text-lg font-semibold mb-2">Explanation for '${currentQuestion.question}'</h4><p>${text}</p>`;
                } else {
                    explanationContent.innerHTML = '<p class="text-red-400">Sorry, I couldn\'t generate an explanation at this time. Please try again.</p>';
                }
            } catch (error) {
                console.error("Error fetching explanation:", error);
                explanationContent.innerHTML = '<p class="text-red-400">An error occurred while fetching the explanation. Please check your network connection.</p>';
            } finally {
                explanationLoading.classList.add('hidden');
                getExplanationBtn.disabled = false;
            }
        };

        // Helper function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Helper function to render LaTeX math using MathJax
        function renderMath() {
            // Dynamically load MathJax if it's not already loaded
            if (typeof MathJax === 'undefined') {
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
                document.head.appendChild(script);
                script.onload = () => {
                    MathJax.typesetPromise();
                };
            } else {
                MathJax.typesetPromise();
            }
        }

        // Initial render
        window.onload = renderTopicCards;
    </script>
</body>
</html>
